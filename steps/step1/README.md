# Step1 - Converting SPSS formatted data

## Reading data from the Wiley Web Site

The data from the book is available in SPSS .sav format and available fror download from the Wiley site
https://www.wiley.com//legacy/wileychi/delaurentis/

In this page, the left "Supplementary material" list element points to a page asking for the term located on Page 106 of the book as loading keyword
Two data sets are proposed: SAS and SPSS-PASW. We have used the second one:
https://www.wiley.com//legacy/wileychi/delaurentis/supp/SPSS-PASW.zip

The package "haven" has been loaded from the USA-CA berkeley CRAN Repository

The RPackage Haven enables to read the SPSS format
https://cran.r-project.org/web/packages/haven/index.html

## Specifying your project directory (Replace by the location of your own project directory)
> projdir = "C:/DLMM_Project/"

## Reading the full dataset and saving it to .csv

> library(haven)<br>
> wcs1org <- read_sav(sprintf("%sW_CS_1_OriginalDataSet.sav", projdir))<br>
> write.csv(wcs1org, file = sprintf("%sW_CS_1_OriginalDataSet.csv", projdir))<br>

## Reading the "training" dataset and saving it to .csv (page 116)

> wcs1train <- read_sav("C:/Projets_En_Cours/AI_MTPL/UCI_Internal_Ratings/SPSS-PASW/W_CS_1_AnalysisSampleDataSet.sav")<br>
> write.csv(wcs1train, file = "C:/Projets_En_Cours/AI_MTPL/UCI_Internal_Ratings/SPSS-PASW/W_CS_1_AnalysisSampleDataSet.csv")<br>

## Reading the "cleaned" training data set and saving it to .csv (page 129)

> wcs2train <- read_sav("C:/Projets_En_Cours/AI_MTPL/UCI_Internal_Ratings/SPSS-PASW/W_CS_1_AnalysisSampleDataSet_2.sav")<br>
> write.csv(wcs2train, file = "C:/Projets_En_Cours/AI_MTPL/UCI_Internal_Ratings/SPSS-PASW/W_CS_1_AnalysisSampleDataSet_2.csv")<br>

The .csv file is modified using a standard text editor so that the first column named INDEX (generated by default by R) is removed,
short names are assigned to the variables and "qualitative" variables values are turned into text by putting them between quotes:
- BADGOOD variable values are transformed and put into "quoted" text: 0 -> "Good" and 1 -> "Bad"
- STATUS  variable values are transformed and put into "quoted" text: 3 -> "Performing", 2 -> "Substandard", 1 -> "Doubtful", 0 -> "Unknown"
- SECTOR
The file is then re-imported<br>

NOTE : The double-quote " being a reserved character in Excel Formulas, one should replce it by an "escape" expression of the form : =""""&E2&""""

Furthermore, the separator in the .csv file being ";" this should be explicitely specified in the read.csv R function<br>

> wcs2train <- read.csv("C:/Projets_En_Cours/AI_MTPL/UCI_Internal_Ratings/SPSS-PASW/W_CS_1_AnalysisSampleDataSet_2B.csv", header=TRUE, sep=";")<br>

Finally, list the name and type of all variables for checking:<br>

> sapply(wcs2train, class)<br>

Double check the content of the BADGOOD field (of type "factor" in R) in order to count the number of companies being Active (labelled "bad") and those being Insolvent (labelled "bad")

> summary(wcs2train$BADGOOD)<br>

Here, the R ouput is: <br>
 "Bad" "Good" <br>
    51   1221 <br>

<strong>NOTE: All resulting files are available for download at :</strong> https://github.com/MoiraCorp/DLMM-IRating-in-R/tree/main/steps/step1/assets
